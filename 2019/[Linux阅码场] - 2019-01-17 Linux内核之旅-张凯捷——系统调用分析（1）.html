<!DOCTYPE html>
<head>
	<meta http-equiv='Content-Type' content='text/html;charset=utf-8'>
	<meta name='viewport' content='width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no'>
	<title>
		Linux内核之旅-张凯捷——系统调用分析（1）
	</title>
	<script src='https://cdn.bootcss.com/jquery/1.10.2/jquery.min.js'>
	</script>
	<style>
		a {color: #607fa6;text-decoration:none;word-wrap:break-word;word-break:break-all;}.rich_media_title{padding-bottom:10px;margin-bottom:14px;border-bottom:1px solid #e7e7eb;font-weight:400;} .rich_media_meta_list{font-size:14px;margin-bottom: 22px;}
		.rich_media_meta{display:inline-block;vertical-align:middle;margin-right:8px;margin-bottom:10px;font-size:14px;}.rich_media_meta_text{color:#8c8c8c;color:rgba(0, 0, 0, 0.3)}.rich_media_meta_list
		em {font-style: normal;}@media screen and (max-width:768px){.rich_media{position:
		relative;padding: 20px 15px 15px;background-color: #fff;}}.rich_media_content{text-align:justify;} .rich_media_content * {max-width:100%!important;box-sizing: border-box!important;-webkit-box-sizing:
		border-box!important;word-wrap: break-word!important;}.rich_media_content
		blockquote {margin: 0;padding-left: 10px;border-left: 3px solid #dbdbdb;}.rich_media_content
		.list-paddingleft-2 {padding-left: 2.2em;}a.rich_media_meta_nickname{display: none;}@media screen and (min-width:1025px){.rich_media{position:relative;}a.rich_media_meta_nickname{display:inline-block!important;}span.rich_media_meta_nickname
		{display: inline-block!important;}.rich_media {width:677px;margin-left:auto;margin-right:auto;}}a.fwjm{font-size: 12px;color: #ececec;}.tenvideo_player {position: relative;width:
		100 %;height: 100 %;margin: auto;background: #000;}* {margin:0px;padding:0px;} body{line-height: 1.6;letter-spacing: .034em;}
		.dy_all {text-align: center;margin: 30px 0;} .dy_all a {display: inline-block;height:
		38px;line-height: 38px;padding: 0 18px;background-color: #009688;color:
		#fff;white-space: nowrap;font-size: 14px;border: none;border-radius: 2px;cursor:
		pointer;text-align: center;outline: 0;-webkit-appearance: none;transition:
		all .3s;-webkit-transition: all .3s;box-sizing: border-box;} img{max-width: 677px!important;}

		.crawler-info{padding: 8px 0;} .article-link>img{margin-left: 20px;width: 16px;}
		.comment-item::before,.comment-item::after{content:'';display:block;height:0;visibility:hidden;clear:both;*zoom:1;} .comment-item{margin-bottom:30px;}
		.avatar{width:12%; padding-right:10px;float:left;box-sizing:border-box;} .avatar img{width:100%;}
		.comment-body{float:left;width:88%;} .comment-body .comment-info{color:#b3b3b3;margin-bottom:4px;margin-top: -5px;} .comment-body .comment-info>span:last-child{float:right;} 
		.comment-author{border-left:4px solid green;padding-left:6px;margin:8px 0;}

		@media screen and (max-width: 420px) {.article-link>img {margin-left: 0px;}}
		@media screen and (min-width: 480px) {.avatar {width: 9%;}.comment-body {width: 91%;}}
	</style>
</head>
<body>
	<div id='js_article' class='rich_media'>
		<div class="crawler-info">
			<a href='https://www.52pojie.cn' class='fwjm' target='_blank'>
				提供的爬取软件来源于：52pojie.cn@夜泉 免费下载使用
			</a>
			<a href='https://mp.weixin.qq.com/s?__biz=MzAwMDUwNDgxOA==&amp;mid=2652665638&amp;idx=1&amp;sn=59aed1d8154d7891295388e8a6606e53&amp;chksm=810f31bbb678b8ade16d70dd4c08f669c9019d1aa7243dd3c48df35cb5ebb905f4414dcf9f9e&amp;scene=27#wechat_redirect&cpage=10' target='_blank' class="article-link">
				<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAQCAMAAABA3o1rAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ1IDc5LjE2MzQ5OSwgMjAxOC8wOC8xMy0xNjo0MDoyMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjk4QUEzQzVDNkNGQjExRTk5NzNBQ0VBMjgzMjY1NjkwIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjk4QUEzQzVENkNGQjExRTk5NzNBQ0VBMjgzMjY1NjkwIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OThBQTNDNUE2Q0ZCMTFFOTk3M0FDRUEyODMyNjU2OTAiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OThBQTNDNUI2Q0ZCMTFFOTk3M0FDRUEyODMyNjU2OTAiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5TKSKsAAAAclBMVEUuLi77+/stLS1VVVXx8fFOTk7s7Ozt7e1qamp5eXlNTU2WlpZFRUU6Ojrq6urn5+d/f3/8/Pw9PT0/Pz+YmJg8PDyZmZlAQECfn5+QkJBBQUFra2vo6OhDQ0OSkpKenp5WVlY+Pj7r6+tpaWksLCz///9o6ILHAAAAJnRSTlP/////////////////////////////////////////////////AKd6gbwAAACNSURBVHjajJHpEoIwDISDVMotcnuCmLz/K9KCdlqO6v7p7Mw3yW4KxG85fnUkIVfZ5J0SsCtqcgRw0HzjQYY2AAOIdRuaK4ReAPJ5nmglL5qICahpU60C0uXguQ9TgIwGJoDnT9z/ABmxt60ot0N2CsDLfb9mvBxs9ql+n5o9bEDBgbif7/1F4g80CjAAqrVAnnsm5f8AAAAASUVORK5CYII=" />
			</a>
		</div>
		<div id="img-content">

                
                <h2 class="rich_media_title" id="activity-name">Linux内核之旅/张凯捷——系统调用分析（1）</h2>
                <div id="meta_content" class="rich_media_meta_list">
                                                                                                            <span class="rich_media_meta rich_media_meta_text">
                                                        张凯捷
                                                    </span>
                                                                
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt"><a href="javascript:void(0);">Linux阅码场</a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">Linux阅码场</strong>
                              <img class="profile_avatar" id="js_profile_qrcode_img" src="" alt="">

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">LinuxDev</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">专业的Linux技术社区和Linux操作系统学习平台，内容涉及Linux内核,Linux内存管理,Linux进程管理,Linux文件系统和IO,Linux性能调优,Linux设备驱动以及Linux虚拟化和云计算等各方各面.</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>


                    <em id="publish_time" class="rich_media_meta rich_media_meta_text">2019-01-17</em>





                </div>

                
                
                                
                
                
                
                                                
                                                                
                                
                
                <div class="rich_media_content " id="js_content">
                    

                    

                    
                    
                    <section class="" data-tools="135编辑器" data-id="94277" style="max-width: 100%;box-sizing: border-box;color: rgb(0, 0, 0);font-family: -webkit-standard;text-align: start;white-space: normal;border-width: 0px;border-style: none;border-color: initial;overflow-wrap: break-word !important;"><section style="max-width: 100%;text-align: center;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section style="max-width: 100%;display: inline-block;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section style="max-width: 100%;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/SeWfibBcBT0HPfjbFvBZyjalUOgdttDVYuKFtncQHKU5ibZ5Haviazyad2N3FWS9oOrs16n26QicunFeR0aC3vibjyw/640?wx_fmt=png&quot;);background-size: 100%;background-position: 50% 0%;background-repeat: repeat-x;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section style="max-width: 100%;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/SeWfibBcBT0HPfjbFvBZyjalUOgdttDVYuKFtncQHKU5ibZ5Haviazyad2N3FWS9oOrs16n26QicunFeR0aC3vibjyw/640?wx_fmt=png&quot;);background-size: 100%;background-position: 50% 100%;background-repeat: repeat-x;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section style="padding-top: 8px;padding-bottom: 8px;max-width: 100%;box-sizing: border-box;overflow-wrap: break-word !important;"><section class="" data-brushtype="text" style="padding: 4px 12px;max-width: 100%;box-sizing: border-box;color: rgb(98, 201, 233);background-color: rgb(253, 251, 227);overflow-wrap: break-word !important;"><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">系统调用的概念</p></section></section></section></section></section></section></section><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></p><section class="" data-tools="135编辑器" data-id="93802" style="max-width: 100%;box-sizing: border-box;text-align: start;white-space: normal;border-width: 0px;border-style: none;border-color: initial;overflow-wrap: break-word !important;"><section style="max-width: 100%;text-align: center;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section style="max-width: 100%;display: inline-block;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section style="margin-right: 1.6em;margin-bottom: -14px;max-width: 100%;font-family: -webkit-standard;text-align: right;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section style="padding-right: 2px;padding-left: 2px;max-width: 100%;box-sizing: border-box;display: inline-block;background-color: rgb(255, 255, 255);overflow-wrap: break-word !important;">//</section></section><section style="max-width: 100%;box-sizing: border-box;border-width: 1px;border-style: solid;border-color: rgb(51, 51, 51);overflow-wrap: break-word !important;"><section class="" data-brushtype="text" style="padding: 10px 1.5em;max-width: 100%;box-sizing: border-box;font-family: -webkit-standard;text-align: left;letter-spacing: 1.5px;overflow-wrap: break-word !important;"><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br  /></p><section class="" data-tools="135编辑器" data-id="93591" style="max-width: 100%;box-sizing: border-box;color: rgb(0, 0, 0);border-width: 0px;border-style: none;border-color: initial;overflow-wrap: break-word !important;"><section style="max-width: 100%;text-align: center;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box;border-width: 1px;border-style: solid;border-color: rgb(162, 162, 162);border-radius: 20px;display: inline-block;overflow-wrap: break-word !important;"><section style="max-width: 100%;display: flex;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section style="margin-left: -1px;max-width: 100%;box-sizing: border-box;width: 25px;height: 25px;border-width: 1px;border-style: solid;border-color: rgb(162, 162, 162);border-radius: 50%;background-color: rgb(251, 232, 232);overflow-wrap: break-word !important;"><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span class="" data-original-title="" title="" style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">1</span></p></section><section style="padding-right: 10px;padding-left: 10px;max-width: 100%;box-sizing: border-box;color: rgb(63, 63, 63);overflow-wrap: break-word !important;"><section class="" data-brushtype="text" style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 16px;line-height: 20px;font-family: serif;box-sizing: border-box !important;overflow-wrap: break-word !important;">Wikipedia</span><span style="max-width: 100%;font-size: 16px;line-height: 20px;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">系统调用的解释</span></p></section></section></section></section></section></section><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br  /></p><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 18px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">系统调用在</span>Wikipedia</strong><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">中的解释为：</span></strong></span></p><p style="max-width: 100%;min-height: 1em;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 18px;box-sizing: border-box !important;overflow-wrap: break-word !important;">In computing, a system call is the programmatic way in which a computer program requests a service from the kernel of the operating system it is executed on. This may include hardware-related services (for example, accessing a hard disk drive), creation and execution of new processes, and communication with integral kernel services such as process scheduling. System calls provide an essential interface between a process and the operating system.</span></p><p style="max-width: 100%;min-height: 1em;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 18px;box-sizing: border-box !important;overflow-wrap: break-word !important;">In most systems, system calls can only be made from userspace processes, while in some systems, OS/360 and successors for example, privileged system code also issues system calls.</span></p><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-family: 宋体;font-size: 18px;box-sizing: border-box !important;overflow-wrap: break-word !important;">主要意思是：</span></p><p style="margin-left: 28px;max-width: 100%;min-height: 1em;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 18px;box-sizing: border-box !important;overflow-wrap: break-word !important;">(1)&nbsp;<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">系统调用是程序以程序化的方式向其执行的操作系统请求服务。</span></span></p><p style="margin-left: 28px;max-width: 100%;min-height: 1em;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 18px;box-sizing: border-box !important;overflow-wrap: break-word !important;">(2)&nbsp;<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">请求的服务可能包括硬件相关服务（访问磁盘驱动器）、新进程创建和执行等。</span></span></p><p style="margin-left: 28px;max-width: 100%;min-height: 1em;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 18px;box-sizing: border-box !important;overflow-wrap: break-word !important;">(3)&nbsp;<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">系统调用在程序和操作系统之间提供一个基本接口。</span></span></p><span style="max-width: 100%;line-height: 20px;font-family: 宋体;font-size: 18px;box-sizing: border-box !important;overflow-wrap: break-word !important;">大多数系统中，系统调用只由处于用户态的进程发出。</span></section><section class="" data-brushtype="text" style="padding: 10px 1.5em;max-width: 100%;box-sizing: border-box;font-family: -webkit-standard;text-align: left;letter-spacing: 1.5px;overflow-wrap: break-word !important;"></section><section class="" data-tools="135编辑器" data-id="93591" style="max-width: 100%;box-sizing: border-box;color: rgb(0, 0, 0);font-family: -webkit-standard;text-align: start;border-width: 0px;border-style: none;border-color: initial;overflow-wrap: break-word !important;"><section style="max-width: 100%;text-align: center;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box;border-width: 1px;border-style: solid;border-color: rgb(162, 162, 162);border-radius: 20px;display: inline-block;overflow-wrap: break-word !important;"><section style="max-width: 100%;display: flex;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section style="margin-left: -1px;max-width: 100%;box-sizing: border-box;width: 25px;height: 25px;border-width: 1px;border-style: solid;border-color: rgb(162, 162, 162);border-radius: 50%;background-color: rgb(251, 232, 232);overflow-wrap: break-word !important;"><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span class="" data-original-title="" title="" data-num="2" style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">2</span></p></section><section style="padding-right: 10px;padding-left: 10px;max-width: 100%;box-sizing: border-box;color: rgb(63, 63, 63);letter-spacing: 1.5px;overflow-wrap: break-word !important;"><section class="" data-brushtype="text" style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 16px;line-height: 20px;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">《</span><span style="max-width: 100%;font-size: 16px;line-height: 20px;font-family: serif;box-sizing: border-box !important;overflow-wrap: break-word !important;">Linux</span><span style="max-width: 100%;font-size: 16px;line-height: 20px;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">操作系统原理与应用》解释：</span></p></section></section></section></section></section></section><section class="" data-brushtype="text" style="padding: 10px 1.5em;max-width: 100%;box-sizing: border-box;font-family: -webkit-standard;text-align: left;letter-spacing: 1.5px;overflow-wrap: break-word !important;"></section><p style="max-width: 100%;min-height: 1em;color: rgb(0, 0, 0);font-family: -webkit-standard;line-height: 20px;font-size: medium;text-indent: 28px;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">陈莉君老师的《</span>Linux<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">操作系统原理与应用</span>(<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">第二版</span>)<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">》对</span>Linux<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">系统调用解释为：</span></p><p style="max-width: 100%;min-height: 1em;font-family: -webkit-standard;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(0, 0, 0);font-size: 16px;line-height: 20px;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;系统调用的实质就是函数调用，只是调用的函数是系统函数，处于内核态而已。用户在调用系统调用时会向内核传递一个系统调用号，然后系统调用处理程序通过此号从系统调用表中找到相应地内核函数执行（系统调用服务例程），最后返回。</span></p><p style="max-width: 100%;min-height: 1em;font-family: -webkit-standard;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br  /></p><section class="" data-tools="135编辑器" data-id="93591" style="max-width: 100%;box-sizing: border-box;text-align: start;border-width: 0px;border-style: none;border-color: initial;overflow-wrap: break-word !important;"><section style="max-width: 100%;text-align: center;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box;border-width: 1px;border-style: solid;border-color: rgb(162, 162, 162);border-radius: 20px;display: inline-block;overflow-wrap: break-word !important;"><section style="max-width: 100%;display: flex;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section style="margin-left: -1px;max-width: 100%;box-sizing: border-box;color: rgb(0, 0, 0);font-family: -webkit-standard;width: 25px;height: 25px;border-width: 1px;border-style: solid;border-color: rgb(162, 162, 162);border-radius: 50%;background-color: rgb(251, 232, 232);overflow-wrap: break-word !important;"><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">3</p></section><section style="padding-right: 10px;padding-left: 10px;max-width: 100%;box-sizing: border-box;letter-spacing: 1.5px;overflow-wrap: break-word !important;"><section class="" data-brushtype="text" style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><p style="max-width: 100%;min-height: 1em;color: rgb(63, 63, 63);font-family: -webkit-standard;box-sizing: border-box !important;overflow-wrap: break-word !important;">总结</p></section></section></section></section></section></section><p style="max-width: 100%;min-height: 1em;font-family: -webkit-standard;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></p><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;color: rgb(0, 0, 0);text-indent: 28px;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">操作系统内核提供了许多服务，服务在物理表现上为内核空间的函数，系统调用即为在用户空间对这些内核提供服务的请求，即在用户空间程序</span><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">“调用”内核空间的函数完成相应地服务。</span></p><p style="max-width: 100%;min-height: 1em;font-family: -webkit-standard;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></p></section><section style="margin-top: -14px;margin-left: 1.6em;max-width: 100%;font-family: -webkit-standard;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section style="padding-right: 2px;padding-left: 2px;max-width: 100%;box-sizing: border-box;display: inline-block;background-color: rgb(255, 255, 255);overflow-wrap: break-word !important;">//</section></section></section></section></section><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></p><section class="" data-tools="135编辑器" data-id="94277" style="max-width: 100%;box-sizing: border-box;color: rgb(0, 0, 0);font-family: -webkit-standard;text-align: start;white-space: normal;border-width: 0px;border-style: none;border-color: initial;overflow-wrap: break-word !important;"><section style="max-width: 100%;text-align: center;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section style="max-width: 100%;display: inline-block;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section style="max-width: 100%;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/SeWfibBcBT0HPfjbFvBZyjalUOgdttDVYuKFtncQHKU5ibZ5Haviazyad2N3FWS9oOrs16n26QicunFeR0aC3vibjyw/640?wx_fmt=png&quot;);background-size: 100%;background-position: 50% 0%;background-repeat: repeat-x;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section style="max-width: 100%;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/SeWfibBcBT0HPfjbFvBZyjalUOgdttDVYuKFtncQHKU5ibZ5Haviazyad2N3FWS9oOrs16n26QicunFeR0aC3vibjyw/640?wx_fmt=png&quot;);background-size: 100%;background-position: 50% 100%;background-repeat: repeat-x;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section style="padding-top: 8px;padding-bottom: 8px;max-width: 100%;box-sizing: border-box;overflow-wrap: break-word !important;"><section class="" data-brushtype="text" style="padding: 4px 12px;max-width: 100%;box-sizing: border-box;color: rgb(98, 201, 233);background-color: rgb(253, 251, 227);overflow-wrap: break-word !important;"><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 12pt;line-height: 20px;box-sizing: border-box !important;overflow-wrap: break-word !important;">系统调用实现分析</span></p></section></section></section></section></section></section></section><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></p><section class="" data-tools="135编辑器" data-id="94072" style="max-width: 100%;box-sizing: border-box;color: rgb(0, 0, 0);font-family: -webkit-standard;text-align: start;white-space: normal;border-width: 0px;border-style: none;border-color: initial;overflow-wrap: break-word !important;"><section style="padding-right: 0.6em;padding-bottom: 1em;padding-left: 0.6em;max-width: 100%;box-sizing: border-box;overflow-wrap: break-word !important;"><section style="max-width: 100%;font-size: 50px;font-weight: bold;display: flex;justify-content: flex-end;align-items: center;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section class="" data-brushtype="text" style="margin-top: -6px;max-width: 100%;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;line-height: 20px;font-family: serif;box-sizing: border-box !important;overflow-wrap: break-word !important;">int / iret</span></section><section style="margin-left: 10px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">0</section><section class="" data-original-title="" title="" style="max-width: 100%;z-index: 999;box-sizing: border-box !important;overflow-wrap: break-word !important;">1</section></section><section style="margin-top: -30px;max-width: 100%;box-shadow: rgb(222, 222, 222) 0px 0px 5px;transform: rotate(0deg);background-color: rgb(254, 254, 254);box-sizing: border-box !important;overflow-wrap: break-word !important;"><section data-autoskip="1" class="" style="padding: 1em;max-width: 100%;box-sizing: border-box;font-size: 14px;text-align: justify;letter-spacing: 1.5px;line-height: 1.75em;color: rgb(63, 62, 63);overflow-wrap: break-word !important;"><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 16px;line-height: 20px;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">早些时候，通过</span><span style="max-width: 100%;font-size: 16px;line-height: 20px;font-family: serif;box-sizing: border-box !important;overflow-wrap: break-word !important;">int 80</span><span style="max-width: 100%;font-size: 16px;line-height: 20px;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">来进行系统调用，调用一个系统调用示意图：</span></p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></p><p style="max-width: 100%;min-height: 1em;text-align: center;line-height: 16.6667px;font-size: 13px;font-family: serif;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">图</span>2-1 int80<span style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">系统调用示意图</span></p><p style="max-width: 100%;min-height: 1em;line-height: 16.6667px;font-size: 13px;font-family: serif;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></p><p style="max-width: 100%;min-height: 1em;line-height: 16.6667px;font-size: 13px;font-family: serif;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;font-family: -webkit-standard;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 16px;line-height: 20px;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">下面基于</span><span style="max-width: 100%;font-size: 16px;line-height: 20px;font-family: serif;box-sizing: border-box !important;overflow-wrap: break-word !important;">linux-2.6.39</span><span style="max-width: 100%;font-size: 16px;line-height: 20px;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">内核进行分析：</span></strong></span></p><h3 style="font-weight: bold;max-width: 100%;line-height: 34.4px;box-sizing: border-box !important;overflow-wrap: break-word !important;">1.1&nbsp;<span style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">初始化系统调用</span></h3><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">内核在初始化期间调用</span>trap_init()<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">函数建立中断描述符表</span>(IDT)<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">中</span>128<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">个向量对应的表项。</span></p><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">在</span><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">arch/x86/kernel/traps.c</strong><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">的</span><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">trap_init()</strong><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">函数中可以看到：</span></p><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">#ifdef CONFIG_X86_32</p><p style="max-width: 100%;min-height: 1em;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">set_system_trap_gate(SYSCALL_VECTOR, &amp;system_call);</p><p style="max-width: 100%;min-height: 1em;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">set_bit(SYSCALL_VECTOR, used_vectors);</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">#endif</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></p><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">SYSCALL_VECTOR<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">在</span><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">arch/x86/include/asm/irq_vectors.h</strong><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">可以看到值为</span><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">0x80</strong><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">，即系统调用对应到</span>0x80</strong><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">号中断。</span></strong></p><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">set_system_trap_gate<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">即用来在</span>IDT<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">上设置系统调用门，在</span><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">arch/x86/include/asm/desc.h</strong><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">可以看到：</span></p><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">static inline void set_system_trap_gate(unsigned int n, void *addr)</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">{</p><p style="max-width: 100%;min-height: 1em;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">BUG_ON((unsigned)n &gt; 0xFF);</p><p style="max-width: 100%;min-height: 1em;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">_set_gate(n, GATE_TRAP, addr, 0x3, 0, __KERNEL_CS);</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">}</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></p><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">可以看到实际上执行的是</span>__set_gate()<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">函数，这个函数把相关值装入门描述符的相应域。</span></p><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">n<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">：即为</span>0x80<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">这一中断号。</span></p><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">GATE_TRAP:&nbsp;<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">在</span><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">arch/x86/include/asm/desc_defs.h</strong><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">中定义为</span>0x0F<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">，表示这一中断（异常）是陷阱。</span></p><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">addr<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">：即为</span>&amp;system_call<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">，系统调用处理程序入口。</span></p><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">0x3:&nbsp;<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">描述符特权级</span>(DPL)<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">，表示允许用户态进程调用这一异常处理程序。</span></p><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">__KERNEL_CS:&nbsp;<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">由于系统调用处理程序处于内核当中，所以应选择</span>__KERNEL_CS<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">填充段寄存器。</span></p><h3 style="font-weight: bold;max-width: 100%;line-height: 34.4px;box-sizing: border-box !important;overflow-wrap: break-word !important;">1.2&nbsp;<span style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">系统调用</span><span style="max-width: 100%;line-height: 20px;font-family: serif;box-sizing: border-box !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;font-family: -webkit-standard;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;line-height: 20px;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">处理</span><span style="max-width: 100%;line-height: 20px;font-family: serif;box-sizing: border-box !important;overflow-wrap: break-word !important;">(system_call())</span></strong></span></h3><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">执行</span>int 80<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">指令后，根据向量号在</span>IDT<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">中找到对应的表项，执行</span>system_call()<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">函数，在</span><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">arch/x86/kernel/entry_32.S</strong><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">中可以看到</span>system_call()<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">函数：</span></p><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">ENTRY(system_call)</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;RING0_INT_FRAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;pushl_cfi %eax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;SAVE_ALL</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;GET_THREAD_INFO(%ebp)</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;testl $_TIF_WORK_SYSCALL_ENTRY,TI_flags(%ebp)</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;jnz syscall_trace_entry</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;cmpl $(nr_syscalls), %eax</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;jae syscall_badsys</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">syscall_call:</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;call *sys_call_table(,%eax,4)</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;movl %eax,PT_EAX(%esp)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">syscall_exit:</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;LOCKDEP_SYS_EXIT</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;DISABLE_INTERRUPTS(CLBR_ANY)&nbsp;&nbsp;&nbsp;&nbsp;</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;TRACE_IRQS_OFF</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;movl TI_flags(%ebp), %ecx</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;testl $_TIF_ALLWORK_MASK, %ecx&nbsp;&nbsp;# current-&gt;work</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;jne syscall_exit_work</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">restore_all:</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;TRACE_IRQS_IRET</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">restore_all_notrace:</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;movl PT_EFLAGS(%esp), %eax&nbsp;&nbsp;# mix EFLAGS, SS and CS</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;movb PT_OLDSS(%esp), %ah</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;movb PT_CS(%esp), %al</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;andl $(X86_EFLAGS_VM | (SEGMENT_TI_MASK &lt;&lt; 8) | SEGMENT_RPL_MASK), %eax</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;cmpl $((SEGMENT_LDT &lt;&lt; 8) | USER_RPL), %eax</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;CFI_REMEMBER_STATE</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;je ldt_ss&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">restore_nocheck:</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;RESTORE_REGS 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">irq_return:</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;INTERRUPT_RETURN</p><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></p><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">主要工作有：</span></p><p style="margin-left: 28px;max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">（</span>1<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">）保存现场：</span></p><p style="margin-left: 56px;max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">pushl_cfi %eax<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">：先把系统调用号保存栈中。</span></p><p style="margin-left: 56px;max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">SAVE_ALL<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">：把异常处理程序可以用到的所有</span>CPU<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">寄存器保存到栈中。</span></p><p style="margin-left: 56px;max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">GET_THREAD_INFO(%ebp)<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">：将当前进程</span>PCB<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">地址存放到</span>ebp<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">中，</span>GET_THREAD_INFO()<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">定义在</span><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">arch/x86/include/asm/thread_info.h</strong><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">。</span></strong></p><p style="margin-left: 28px;max-width: 100%;min-height: 1em;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">（2）<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">跳转到相应服务程序：</span></p><p style="margin-left: 56px;max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">cmpl $(nr_syscalls), %eax<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">：先检查用户态进程传来的系统调用号是否有效，如果大于等于</span>NR_syscalls<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">，则跳转到</span>syscall_badsys,<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">终止系统调用程序，返回用户空间。</span></p><p style="margin-left: 56px;max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">syscall_badsys<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">：将</span>-ENOSYS<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">存放到</span>eax<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">寄存器所在栈中位置，再跳转到</span>resume_userspace<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">返回用户空间，返回后</span>EAX<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">中产生负的</span>ENOSYS<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">。</span></p><p style="margin-left: 56px;max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">call *sys_call_table(,%eax,4)<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">：根据</span>EAX<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">中的系统调用号调用对应的服务程序。</span></p><p style="margin-left: 28px;max-width: 100%;min-height: 1em;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">（3）<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">退出系统调用：</span></p><p style="margin-left: 56px;max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">movl %eax, PT_EAX(%esp)<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">：保存返回值。</span></p><p style="margin-left: 56px;max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">syscall_exit_work -&gt; work_pending -&gt; work_notifysig<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">来处理信号。</span></p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 16px;line-height: 20px;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">可能执行</span><span style="max-width: 100%;font-size: 16px;line-height: 20px;font-family: serif;box-sizing: border-box !important;overflow-wrap: break-word !important;">call schedule</span><span style="max-width: 100%;font-size: 16px;line-height: 20px;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">来进行进程调度；或者跳转到</span><span style="max-width: 100%;font-size: 16px;line-height: 20px;font-family: serif;box-sizing: border-box !important;overflow-wrap: break-word !important;">resume_userspace</span><span style="max-width: 100%;font-size: 16px;line-height: 20px;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">，调用</span><span style="max-width: 100%;font-size: 16px;line-height: 20px;font-family: serif;box-sizing: border-box !important;overflow-wrap: break-word !important;">restall_all</span><span style="max-width: 100%;font-size: 16px;line-height: 20px;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">恢复现场，返回用户态。</span></p><h3 style="font-size: 20px;max-width: 100%;line-height: 34.4px;color: rgb(0, 0, 0);box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;">1.3&nbsp;</span><span style="max-width: 100%;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;">系统调用表</span></h3><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;color: rgb(0, 0, 0);text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">在</span>system_call()<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">函数中的</span>call *sys_call_table(,%eax,4)&nbsp;<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">语句中，根据</span>eax<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">寄存器中所存的系统调用号到</span>sys_call_table<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">系统调用表中找到对应的系统调用服务程序</span></p><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;color: rgb(0, 0, 0);text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">由于是</span>32<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">位即每个</span>sys_call_table<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">是</span>4<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">个字节，如果是</span>64<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">位则程序语句为</span>call *sys_call_table(, %eax, 8)</p><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;color: rgb(0, 0, 0);text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;</p><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;color: rgb(0, 0, 0);text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">在</span>linux-2.6.39</strong><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">内核源码中</span></strong><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">：</span></p><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;color: rgb(0, 0, 0);text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;</p><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;color: rgb(0, 0, 0);text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">32<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">位下系统调用表在</span><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">arch/x86/kernel/syscall_table_32.S</strong><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">中定义，每个表项包含一个系统调用服务例程的地址：</span></p><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;color: rgb(0, 0, 0);text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;</p><p style="max-width: 100%;min-height: 1em;border-width: initial;border-style: none;border-color: initial;font-size: 16px;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">ENTRY(sys_call_table)</p><p style="max-width: 100%;min-height: 1em;border-width: initial;border-style: none;border-color: initial;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.long sys_restart_syscall&nbsp;&nbsp;&nbsp;/* 0 - old "setup()" system call, used for r&nbsp;&nbsp;&nbsp;&nbsp;estarting */</p><p style="max-width: 100%;min-height: 1em;border-width: initial;border-style: none;border-color: initial;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.long sys_exit</p><p style="max-width: 100%;min-height: 1em;border-width: initial;border-style: none;border-color: initial;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.long ptregs_fork</p><p style="max-width: 100%;min-height: 1em;border-width: initial;border-style: none;border-color: initial;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.long sys_read</p><p style="max-width: 100%;min-height: 1em;border-width: initial;border-style: none;border-color: initial;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.long sys_write</p><p style="max-width: 100%;min-height: 1em;border-width: initial;border-style: none;border-color: initial;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.long sys_open&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* 5 */</p><p style="max-width: 100%;min-height: 1em;border-width: initial;border-style: none;border-color: initial;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</p><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;color: rgb(0, 0, 0);text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;</p><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;color: rgb(0, 0, 0);text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">64<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">位系统的若要使用</span>syscall<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">指令来进行系统调用而不使用</span>int 80<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">，则用到的系统调用表在</span><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">arch/x86/kernel/syscall_64.c</strong><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">中定义：</span></p><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;color: rgb(0, 0, 0);text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;</p><p style="max-width: 100%;min-height: 1em;border-width: initial;border-style: none;border-color: initial;font-size: 16px;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">#define __SYSCALL(nr, sym) [nr] = sym,</p><p style="max-width: 100%;min-height: 1em;border-width: initial;border-style: none;border-color: initial;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;const sys_call_ptr_t sys_call_table[__NR_syscall_max+1] = {</p><p style="max-width: 100%;min-height: 1em;border-width: initial;border-style: none;border-color: initial;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[0 ... __NR_syscall_max] = &amp;sys_ni_syscall,</p><p style="max-width: 100%;min-height: 1em;border-width: initial;border-style: none;border-color: initial;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;#include &lt;asm/unistd_64.h&gt;</p><p style="max-width: 100%;min-height: 1em;border-width: initial;border-style: none;border-color: initial;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;};</p><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;color: rgb(0, 0, 0);text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;</p><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;color: rgb(0, 0, 0);text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">可以看到系统调用表是</span>include<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">进去的，</span><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">arch/x86/include/asm/unistd_64.h</strong><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">中放着：</span></p><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;color: rgb(0, 0, 0);text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;</p><p style="max-width: 100%;min-height: 1em;border-width: initial;border-style: none;border-color: initial;font-size: 16px;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">#define __NR_read&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</p><p style="max-width: 100%;min-height: 1em;border-width: initial;border-style: none;border-color: initial;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;__SYSCALL(__NR_read, sys_read)</p><p style="max-width: 100%;min-height: 1em;border-width: initial;border-style: none;border-color: initial;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;#define __NR_write&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1</p><p style="max-width: 100%;min-height: 1em;border-width: initial;border-style: none;border-color: initial;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;__SYSCALL(__NR_write, sys_write)</p><p style="max-width: 100%;min-height: 1em;border-width: initial;border-style: none;border-color: initial;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;#define __NR_open&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2</p><p style="max-width: 100%;min-height: 1em;border-width: initial;border-style: none;border-color: initial;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;__SYSCALL(__NR_open, sys_open)</p><p style="max-width: 100%;min-height: 1em;border-width: initial;border-style: none;border-color: initial;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;...</p><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;color: rgb(0, 0, 0);text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;</p><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;color: rgb(0, 0, 0);text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">所以在宏</span>__SYSCALL<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">的作用下，系统调用表为如下定义：</span></p><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;color: rgb(0, 0, 0);text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;</p><p style="max-width: 100%;min-height: 1em;border-width: initial;border-style: none;border-color: initial;font-size: 16px;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">const sys_call_ptr_t sys_call_table[__NR_syscall_max+1] = {</p><p style="max-width: 100%;min-height: 1em;border-width: initial;border-style: none;border-color: initial;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[0 ... __NR_syscall_max] = &amp;sys_ni_syscall,</p><p style="max-width: 100%;min-height: 1em;border-width: initial;border-style: none;border-color: initial;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[0] = sys_read,</p><p style="max-width: 100%;min-height: 1em;border-width: initial;border-style: none;border-color: initial;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[1] = sys_write,</p><p style="max-width: 100%;min-height: 1em;border-width: initial;border-style: none;border-color: initial;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[2] = sys_open,</p><p style="max-width: 100%;min-height: 1em;border-width: initial;border-style: none;border-color: initial;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</p><p style="max-width: 100%;min-height: 1em;border-width: initial;border-style: none;border-color: initial;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</p><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></p></section></section></section></section><section class="" data-tools="135编辑器" data-id="94072" style="max-width: 100%;box-sizing: border-box;color: rgb(0, 0, 0);font-family: -webkit-standard;text-align: start;white-space: normal;border-width: 0px;border-style: none;border-color: initial;overflow-wrap: break-word !important;"><section style="padding-right: 0.6em;padding-bottom: 1em;padding-left: 0.6em;max-width: 100%;box-sizing: border-box;overflow-wrap: break-word !important;"><section style="max-width: 100%;font-size: 50px;font-weight: bold;display: flex;justify-content: flex-end;align-items: center;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section class="" data-brushtype="text" style="margin-top: -6px;max-width: 100%;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;line-height: 20px;font-family: serif;box-sizing: border-box !important;overflow-wrap: break-word !important;">vsyscalls&nbsp;</span><span style="max-width: 100%;line-height: 20px;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">和</span><span style="max-width: 100%;line-height: 20px;font-family: serif;box-sizing: border-box !important;overflow-wrap: break-word !important;">vDSO</span></section><section style="margin-left: 10px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">0</section><section class="" data-original-title="" title="" style="max-width: 100%;z-index: 999;box-sizing: border-box !important;overflow-wrap: break-word !important;">2</section></section><section style="margin-top: -30px;max-width: 100%;box-shadow: rgb(222, 222, 222) 0px 0px 5px;transform: rotate(0deg);background-color: rgb(254, 254, 254);box-sizing: border-box !important;overflow-wrap: break-word !important;"><section data-autoskip="1" class="" style="padding: 1em;max-width: 100%;box-sizing: border-box;font-size: 14px;text-align: justify;letter-spacing: 1.5px;line-height: 1.75em;color: rgb(63, 62, 63);overflow-wrap: break-word !important;"><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;widows: 1;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">在</span>Linux<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">中调用系统调用的操作代价很大，因为处理器必须中断当前正在执行的任务并从用户态切换到内核态，执行完系统调用程序后又从内核态切换回用户态。</span></p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;widows: 1;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">为了加快系统调用的速度，随后先后引入了两种机制</span>——vsycalls<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">和</span>vDSO<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">。</span></p><h3 style="font-weight: bold;max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;widows: 1;line-height: 34.4px;box-sizing: border-box !important;overflow-wrap: break-word !important;">2.1 vsyscalls</h3><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;widows: 1;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">vsyscalls<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">的工作原理即为：</span>Linux<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">内核将第一个页面映射到用户空间，该页面包含一些变量和一些系统调用的实现，被映射到用户空间的系统调用即可以在用户空间执行，不需要进行上下文切换。</span></p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;widows: 1;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">执行命令如下命令可以看到有关</span>vsyscalls<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">内存空间的信息：</span></p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">$ sudo cat /proc/1/maps | grep vsyscall</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[vsyscall]</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;widows: 1;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;widows: 1;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">vsyscall<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">页面映射从内核启动开始</span><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">start_kernel() -&gt; setup_arch() -&gt; map_vsyscall()</strong><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">，</span>map_vsyscall()<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">函数源码在</span><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">arch/x86/entry/vsyscall/vsyscall_64.c</strong><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">中：</span></p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;widows: 1;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">void __init map_vsyscall(void)</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">{</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;extern char __vsyscall_page;</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;unsigned long physaddr_vsyscall = __pa_symbol(&amp;__vsyscall_page);</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;if (vsyscall_mode != NONE) {</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__set_fixmap(VSYSCALL_PAGE, physaddr_vsyscall,</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PAGE_KERNEL_VVAR);</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set_vsyscall_pgtable_user_bits(swapper_pg_dir);</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;}</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;BUILD_BUG_ON((unsigned long)__fix_to_virt(VSYSCALL_PAGE) !=</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;(unsigned long)VSYSCALL_ADDR);</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">}</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;widows: 1;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;widows: 1;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">可以看到页面映射函数中首先使用</span>__pa_symbol<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">宏获取页面的物理地址。</span></p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;widows: 1;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">__vsyscall_page<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">在</span><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">arch/x86/entry/vsysall/vsyscall_emu_64.S</strong><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">中定义，可以看出来</span>__vsyscall_page<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">包含三个系统调用：</span>gettimeofday, time, getcpu<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">：</span></p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;widows: 1;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">__vsyscall_page:</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov $__NR_gettimeofday, %rax</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;syscall</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.balign 1024, 0xcc</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov $__NR_time, %rax</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;syscall</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.balign 1024, 0xcc</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov $__NR_getcpu, %rax</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;syscall</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;widows: 1;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;widows: 1;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">获取页面的物理地址之后检查</span>vsyscall_mode<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">变量的值并使用</span>__set_fixmap<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">宏来设置页面的修复映射地址</span>(Fix-Mapped Address)<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">，</span>__set_fixmap<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">在</span><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">arch/x86/include/asm/fixmap.h</strong><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">中定义：</span></p><p style="margin-left: 28px;max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">（1）&nbsp;<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">第一个参数是枚举类型</span>fixed_addresses<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">，这里传入参数实际值为</span>(0xfffff000 - (-10UL &lt;&lt; 20)) &gt;&gt; 12<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">：</span></p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">#ifdef CONFIG_X86_VSYSCALL_EMULATION</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">VSYSCALL_PAGE = (FIXADDR_TOP - VSYSCALL_ADDR) &gt;&gt; PAGE_SHIFT,</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">#endif</p><p style="margin-left: 28px;max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">（2）&nbsp;<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">第二个参数是必须映射的页面的物理地址，这里传入通过</span>__pa_symbol<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">宏定义获取到的物理地址</span></p><p style="margin-left: 28px;max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">（3）&nbsp;<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">第三个参数是页面的</span>flags<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">，传入的是</span>PAGE_KERNEL_VVAR<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">，在</span><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">arch/x86/include/asm/pgtable_types.h</strong><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">中定义，</span>_PAGE_USER<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">意味着可以通过用户模式的进程访问该页面：</span></p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">#define default_pgprot(x)&nbsp;&nbsp;&nbsp;__pgprot((x) &amp; __default_kernel_pte_mask)</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">#define __PAGE_KERNEL_VVAR&nbsp;&nbsp;&nbsp;(__PAGE_KERNEL_RO | _PAGE_USER)</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">#define PAGE_KERNEL_VVAR&nbsp;&nbsp;&nbsp;&nbsp;default_pgprot(__PAGE_KERNEL_VVAR | _PAGE_ENC)</p><p style="margin-left: 56px;max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;widows: 1;line-height: 20px;font-size: medium;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;widows: 1;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">设置完页面的修复地址后调用</span>set_vsyscall_pgtable_user_bits()<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">函数对覆盖</span>VSYSCALL_ADDR<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">的表设置</span>_PAGE_USER<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">；最后使用</span>BUILD_BUG_ON<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">宏来检查</span>vsyscall<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">页面的虚拟地址是否等于</span>VSTSCALL_ADDR<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">的值。</span></p><h3 style="font-weight: bold;max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;widows: 1;line-height: 34.4px;box-sizing: border-box !important;overflow-wrap: break-word !important;">2.2 vDSO</h3><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;widows: 1;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">虽然引入了</span>vsyscall<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">机制，但是</span>vsyscall<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">存在着问题：</span></p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">（1）vsyscall<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">的用户空间映射的地址是固定不变的，容易被黑客利用。</span></p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">（2）vsyscall<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">能支持的系统调用数有限，不易扩展。</span></p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;widows: 1;line-height: 20px;font-size: medium;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;widows: 1;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">vDSO<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">是</span>vsyscall<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">的主要替代方案，是一个虚拟动态链接库，将内存页面以共享对象形式映射到每个进程，用户程序在启动的时候通过动态链接操作，把</span>vDSO<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">链接到自己的内存空间中。动态链接保证了</span>vDSO<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">每次所在的地址都不一样，并且可以支持数量较多的系统。</span></p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;widows: 1;line-height: 20px;font-size: medium;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;widows: 1;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">执行下列命令：</span></p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">$ ldd /bin/uname</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">linux-vdso.so.1 =&gt;&nbsp;&nbsp;(0x00007ffcb75de000)</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f3c36e1d000)</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">/lib64/ld-linux-x86-64.so.2 (0x00007f3c371e7000)</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;widows: 1;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;widows: 1;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;widows: 1;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">可以看到</span>uname util<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">与三个库链接：</span></p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;widows: 1;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;- linux-vdso.so.1<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">：提供</span>vDSO<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">功能。</span></p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;widows: 1;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;- lib.so.6<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">：</span>C<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">标准库。</span></p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;widows: 1;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;- ld-linux-x86-64.so.2<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">：程序解释器</span>(<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">链接器</span>)<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">。</span></p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;widows: 1;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;widows: 1;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">初始化</span>vDSO<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">发生在</span><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">arch/x86/entry/vdso/vma.c</strong><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">的</span>init_vdso()<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">函数中：</span></p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;widows: 1;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">static int __init init_vdso(void)</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">{</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;init_vdso_image(&amp;vdso_image_64);</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">#ifdef CONFIG_X86_X32_ABI</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;init_vdso_image(&amp;vdso_image_x32);</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">#endif</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;return 0;</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">}</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;widows: 1;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></p><p style="margin-left: 16px;max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;widows: 1;text-align: left;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">使用</span>init_dso_image()<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">函数来初始化</span>vdso_image<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">结构体，</span>vdso_image_64<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">和</span>vdso_image_x32<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">在</span><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">arch/x86/entry/vdso/vdso-image-64.c</strong><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">和</span><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">arch/x86/entry/vdso/vdso-image-x32.c</strong><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">中进行定义<strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">，</strong>例如</span>vdso_image_64</p><p style="margin-left: 16px;max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;widows: 1;text-align: left;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">对</span>vDOS<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">系统调用的内存页面相关的结构体初始化后，使用从</span><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">arch/x86/entry/vdso/vma.c</strong><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">中调用函数</span>arch_setup_additional_pages()<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">来检查并调用</span>map_vdso_randomized() -&gt; map_vdso()<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">函数来进行内存页面映射：</span></p><p style="margin-left: 16px;max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;widows: 1;text-align: left;line-height: 20px;font-size: medium;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">int arch_setup_additional_pages(struct linux_binprm *bprm, int uses_interp)</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">{</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;if (!vdso64_enabled)</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 0;</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">&nbsp;&nbsp;&nbsp;&nbsp;return map_vdso_randomized(&amp;vdso_image_64);</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;">}</p><p style="max-width: 100%;min-height: 1em;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></p><section class="" data-tools="135编辑器" data-id="93976" style="max-width: 100%;box-sizing: border-box;font-variant-numeric: normal;font-variant-east-asian: normal;line-height: 24.5px;widows: 1;color: rgb(0, 0, 0);text-align: start;border-width: 0px;border-style: none;border-color: initial;overflow-wrap: break-word !important;"><section style="padding: 0.6em;max-width: 100%;box-sizing: border-box;overflow-wrap: break-word !important;"><img class="" data-ratio="0.06478405315614617" data-type="png" data-w="602" data-width="100%" src="data:image/PNG;base64,iVBORw0KGgoAAAANSUhEUgAAAloAAAAnCAMAAADgphbuAAACIlBMVEUAAAAAAACAgIBVVVVAgIBmZmZVVYBJbW1gYIBVVXFNZoBdXXRVampOYnZbW21VZndgYHBaWnhVY3FeXnlZZnNVYXldXXRZZG9cXHBYYnZVXnFVYHVbZHZYYXJ3gJHi5Ob29vb8/f3+/v6FhZn9/f3X29/5+fvr6+7z9PTz9PTp6+7+/v78/Pzh5Obg4+X8/Pyxt8L+/v7e3uT6+vvt7e/29vb29vb6+vvg4+ZocYTx8fPY297Y2N6mrLfo6uz+/v7y8vb5+fr5+fry8vXr7e/r7e/f4eT19fa/w8v6+/v+/v54gI/AxMzf3+Th5Ob6+/v09PaDiZb+/v7r7e+7v8fc3OH9/f3Pz9WlqrPk5uj8/f1tdYpVXnfv7/D3+PhaY3Pk5Oj9/f3l5epdZHzx8fOAhpjn5+uwtLzS0tf+/v7n5+vz8/Tl5er39/f////Q0NZYYHjw8PL+/v5aYnj3+Pj8/PyIjprx8fT39/f8/f3JzdOqrrff4eb////6+vuLkZzs7vD39/djan/19/f+/v7+/v7e3uP3+fqSmKPz9fVqcX/9/f3V19xudYru7u/////AxMuOk5/z8/b3+frOztT19fa8wMja2t/7+/v+/v6ip7VyeY3j5uj9/f3r7e7w8PGhpbPo6uzKzdOdorFfZnx5gJOtsbr8/Pz+/v719ffDxs2XnKdVXXSCiJS3t8Pd3eLx8fL9/f3z8/Xf4uS9vcj///8mf2/6AAAAtXRSTlMAAQIDBAUGBwgJCgsMDQ4PEBESExQVFhcZGhsYHB0eaLDj+hneQLdnkZBo9dxnY98u71XJfaOiyGQbllVULnzsosjHoY6NZrJA2PciQWdm1rIn84xAZuZVNnrlIx6cxB9752whpCp/PVr2fqRttfxXIJ7xIsLeK5+25FE5cP7SLJe4JLf57m3KL60k7WAlk/1JLbDJU7NFZ9r8NyZ46YuXNoNSNCMoO+L7u0wxIStAaKPsrnFG5CovcgAAB/pJREFUeNrtmem3FMUZxpnp6X1fqqpXYnDPJUGNWSRRA1mM17iiUXB0IMRcyKKDCIkgYkzcQUXcN9xX3J3/L6equudOd1XP3DlhPuSkns+/89b7PP12VS/r1jXUqbRuijoNzYH+r7EihrXGMBPpVmrB69AEO7Pg/GznDLHdM8+KGJgWWueLMpLUKyVJBOZgJSWXmoMlKJft8NluC9vlsp0WVuKzZ9Ta/3UMUm/CEgci9WRFUYkUWe4RlIP1ZFlRVa3ULFZZZVVVUWTcZue/YLEdicvyWpiHnduaiKFkFVyO9tnl9dmTFVXTDcM0TdPQNVVhq9FaBDNNi4iyMpeVJLmFZdany+u6UaKWaRi6prSzpNMxq+tqO8u2oMiSxLXGY0UMs2PAIgV7jZuATpai6oZlO67nea5jW4amyLharVi3K8mKRjEfi7AmZRsL0xYZVteUpvnSut5gLVNX+ayi6qaFO6UsaVdnLxZlNd20G2x5YZvxY2ssK2KYEYNpO47r0MWVxmxV9SzHC8IIABCFvmebutoIinCqbtqeH0YAIoQQxKxrmzTUeo84JlISEBaWrEFD5bMRgBUb+K7FYUlMhuX6NdZzLBxqI1PK2i5pl7AAhK2srGhmyY6tiRhmx+D6YRhFpGDz5ioZy/FDgOIkTdMkQ1HgWHojKLKubjlBhOIkz4uiKPI0yWDkOyY232mwqm65AUBxSlDKhpTtMqxhe+EkG2cg9GxDw+Zr3nuyRthsgkWEVRvtdro9RTMdP4RZMskGrqUzrETZaMzmeRKLGNYSA8ziJMaL+45Vm8BqstwQrv/OWd/dMCp1tmvpSq9erKfolnv2qKlzgjKoeo+65Z3LsOf5jqHVmux08Pq2dz7DXuA3gyrj9y9k2O95NrbVqbOa4fjnMey5HrZWZ0mkwTkMK2JYUwxLG8/6/noYurXZIvulbnkR+sGmyWIX4aAmDZEeTSe4iFn3Yhg4Rs1QpyspmumGlzDsDwEOqldj6fqXMuyPgNcwVLE/ZthLowaLLyuOH/yEYS8JXVNTpBorq4YTwIsZVsSw5hg2/RTR1SuMTKrlRpdtrhf7GSTmJ3c30iP8ObPu6HLg25OGqh7RFQx6ZUyWl2qsZjoh+gXDbskit2aI+nGjbCvD/hKFxHxngiXxx1cy7BWoMQPkUtk+uJy1JmKYI4bNl0WuNd64S/shakzW6Fcx8Cwy1J3q3FQ0ywPxr9mFfxPXzHeqHpOrWPa3WeiYq4YqFqZXM+jyNcT82BD14wTommWGvTqF5XXtrF5W0wmz37EtXJWAOlteqvhalhUxzBPDZhSuTiudah9e1yx2fZGFZVD0ez5ZN8yK69mFb8jLG6DGRvGNN7HsthwG5CyoWLK3g+RmFh3dko7Nj1nbB+ktHPbmpDo3yhbwXRXAfBuL3nTjeAaqdsmlym9gWRHDXDFcB/3xZkzvgHD975lqt5ZB4Y9l9EMaWfdWjp/l21JInzUrFu/tWbGdw+64PQGeTd43KKuQvb1/B4e9cxBXp3fJkr19cCeHvaNPzo0xKyu67YHk9h0cdmeRkXOjtEafiWF62zKHFTHME8Ou9SHdYPFoSTLe2P7AFtuyO4X4PUbBf5Hwl1/D8WG6eytn3dEfB3hznWBNJ0DpXTw/oz/1SVBqyaq66YYoX+H5Ge0psoi8dcjkpxZ+kY2yYg8P3buSo9DF319oCyqJv/9nHrvjrhSR17mxNXxsDf7CY0UMc8XwV3xwyhIeLXwe2gH6G6fadhyUY+ka/quo6aaD1+XdgaPR3ff0Y+A7ZskalhvAdLiPy967UmQR/giHWQ2zIcr338dlDxzMM/ythrI6/pKT5QcPcNn79uNQLUOjrGl7UVas3Mtl/z5MYYDZVWtx/567uayIYZ4Y/oECG5+I9KXAcML4fk6xvYcGCQw9x8K/FS3HC2EyOLSXu+5o1+F+DALXtkyDsigdPHCEzz54tJhk/Qilw4f46OifD+dZ5Du2iVnb8aMsf/hfLexDwxRFPm7XMC3bDUBcHHyQjx55YJAiaq1i+4d38VkRwzwx3B+HjkHeEcmjlhsl/+ZVe+TQIM1A4Huu6/kByNLBoUda/IwOrPQTFAUeYUOQ5cNHN7Sxjz1OWZewMM6H29rQ0RNPFjEM/TFbPPlEK7ttmI/ZIEJJ//HH2tANjw7zDBDWw2zaX9nUxooY5ohhQxK59GELj5bpgZRfbXnn7iLJIIgiALOk2L1z76hVTx0brrJp//jTz7SzG58d5DEiLIrT/onn2tHRycOYBSACAMX54PCWKexzJ/r4FwZuAbPPbmxHn3n6eD9dtTY89lQ7K2KYI4YUeGY5WvgpHuZt5bY8P+znaZqmeX/4/NbRVL3wImYTzO5/6eWp6Cv7Xh0UhC0Gr73+xlR26c0TlM2LwYk3l6ayb7z+2qBIKfvqvlemsi+/tB9bS7C1F1+Ybk3EsOYYcoif46vR8mHRXm7jqT1vHT/+1p5TU2a/1JGTb7/z7nvvf3Ds1Icz2Y8+3v7Jp6c/+/yLL7+ayS59/c23R08f/fabr5dmsl99+cXnn53+9JPtH380k/3w1LEP3n/v3XfePnlkJitiWGMMBfTXOlpCQvOoMVpIjJbQGVKBxGgJLURitIQWJDFaQguSGC2hBUmMltCCJEZLaEESoyW0IInRElqQxGgJLUhitIQWJDFaQguSGC2hBUmMltCCJEZLaEESoyW0IInRElqQqtH6D6OY7amTRR7ZAAAAAElFTkSuQmCC " src="SeWfibBcBT0HPfjbFvBZyjalUOgdttDVYkXhzaCUjYmd140NYlibhA4LE3yOXIPJJ4MYxBpz0vrXUx4u4SWI5JzQ"  style="display: block;box-sizing: border-box !important;overflow-wrap: break-word !important;width: 0px !important;visibility: visible !important;"  /><section style="padding-right: 4px;padding-left: 4px;max-width: 100%;box-sizing: border-box;overflow-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box;box-shadow: rgb(229, 229, 229) 1px 1px 6px;border-bottom-left-radius: 15px;border-bottom-right-radius: 15px;overflow-wrap: break-word !important;"><section style="padding: 1em 1.4em 1em 0.6em;max-width: 100%;box-sizing: border-box;box-shadow: rgb(229, 229, 229) -1px 1px 6px;border-bottom-left-radius: 15px;border-bottom-right-radius: 15px;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/SeWfibBcBT0HPfjbFvBZyjalUOgdttDVYNUy6cibWdicrHibBQpSMRicibMVP68kadf3jKn9mjcQsOzTx5eGS64ib5y1g/640?wx_fmt=png&quot;);background-size: 40%;background-position: 0% 100%;background-repeat: no-repeat;overflow-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box;border-top: 1px solid rgb(91, 113, 126);border-right: 1px solid rgb(91, 113, 126);border-bottom-style: none;border-left-style: none;overflow-wrap: break-word !important;"><section style="margin-top: -7px;padding-top: 2px;padding-bottom: 2px;max-width: 100%;box-sizing: border-box;width: 22px;overflow-wrap: break-word !important;"><img class="" data-ratio="0.7894736842105263" data-type="png" data-w="19" src="data:image/PNG;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAAPBAMAAAD0aukfAAAALVBMVEUAAABVcXFccIBAgIBccIAAAABbcH9acX5gcIBbcX5bcH5ccH5ccX9Ycn1bcX4Et6rnAAAADnRSTlMACVAEQAGPYxDgqMMkMYhZovcAAABiSURBVAjXpcehDcJQAAXA+wkoKjoBYQgMHkmaOgSmExBGYJKGCVAMwCSk6puGNwPpDLg7lB3sW9bXCefcOWSijAufuXFJ7TX5olu+yQPjjG0GSio+eZ00mY9vXVKtkgz/8wfyt0d6GUt/rAAAAABJRU5ErkJggg== " src="SeWfibBcBT0HPfjbFvBZyjalUOgdttDVYeyLPWTuYtiauAnSbOmJ39R6NNuAsZfKfj74ibQtxXMjGZ9vkygUIZu0g"  style="margin-right: auto;margin-left: auto;display: block;box-sizing: border-box !important;overflow-wrap: break-word !important;width: 12px !important;visibility: visible !important;"  /></section><section data-autoskip="1" class="" style="padding: 0.7em 0.8em 1.2em 1em;max-width: 100%;box-sizing: border-box;line-height: 1.75em;text-align: justify;overflow-wrap: break-word !important;"><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;font-family: serif;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(121, 123, 170);box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">上面说到的</span>vsyscalls<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">和</span>vDSO<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">都是从机制上对系统调用速度进行的优化，但是使用软中断来进行系统调用需要进行特权级的切换这一根本问题没有解决。</span></span></p><p style="max-width: 100%;min-height: 1em;line-height: 20px;font-size: medium;font-family: serif;text-indent: 28px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(121, 123, 170);box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">为了解决这一问题，</span>Intel x86 CPU<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">从</span>Pentium II (Family6, Model 3, Stepping 3)<span style="max-width: 100%;font-family: 宋体;box-sizing: border-box !important;overflow-wrap: break-word !important;">之后，开始支持快速系统调用指令</span><strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">sysenter/sysexit，下篇将进行具体介绍。</strong></span></p></section></section><section style="margin-top: -9px;max-width: 100%;text-align: right;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section data-width="50%" style="max-width: 100%;width: 0px;display: inline-block;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section style="margin-top: -5px;padding-top: 2px;padding-bottom: 2px;max-width: 100%;box-sizing: border-box;width: 22px;overflow-wrap: break-word !important;"><img class="" data-ratio="0.7894736842105263" data-type="png" data-w="19" src="data:image/PNG;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAAPBAMAAAD0aukfAAAALVBMVEUAAABVcXFccIBAgIBccIAAAABbcH9acX5gcIBbcX5bcH5ccH5ccX9Ycn1bcX4Et6rnAAAADnRSTlMACVAEQAGPYxDgqMMkMYhZovcAAABiSURBVAjXpcehDcJQAAXA+wkoKjoBYQgMHkmaOgSmExBGYJKGCVAMwCSk6puGNwPpDLg7lB3sW9bXCefcOWSijAufuXFJ7TX5olu+yQPjjG0GSio+eZ00mY9vXVKtkgz/8wfyt0d6GUt/rAAAAABJRU5ErkJggg== " src="SeWfibBcBT0HPfjbFvBZyjalUOgdttDVYeyLPWTuYtiauAnSbOmJ39R6NNuAsZfKfj74ibQtxXMjGZ9vkygUIZu0g"  style="margin-right: auto;margin-left: auto;display: block;transform: scale(-1);box-sizing: border-box !important;overflow-wrap: break-word !important;width: 13px !important;visibility: visible !important;"  /></section></section></section></section></section></section></section></section></section></section></section></section><p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;"><br  /></p><section style="max-width: 100%;box-sizing: border-box;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);overflow-wrap: break-word !important;"><section class="" powered-by="xiumi.us" style="max-width: 100%;box-sizing: border-box;overflow-wrap: break-word !important;"><section style="margin-bottom: 10px;max-width: 100%;box-sizing: border-box;overflow-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box;background-color: rgb(232, 177, 190);height: 3px;overflow-wrap: break-word !important;"></section></section></section></section><p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;"><strong style="letter-spacing: 0.544px;max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;letter-spacing: 0.544px;color: rgb(61, 167, 66);box-sizing: border-box !important;overflow-wrap: break-word !important;">查看我们精华技术文章请移步:</span></strong></p><p style="max-width: 100%;min-height: 1em;letter-spacing: 0.544px;white-space: normal;widows: 1;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MzAwMDUwNDgxOA==&amp;mid=2652665556&amp;idx=1&amp;sn=17bc2adf8ce33ad0fef063b9e82f4dfa&amp;chksm=810f3049b678b95f0ecd89dfde2ad4ba8ffe15a9d7a63e7bec7b04c79b780ef4719f1120a179&amp;scene=21#wechat_redirect" target="_blank" data-linktype="2" style="color: rgb(87, 107, 149);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;">Linux阅码场原创精华文章汇总</a></p><p><br  /></p>
                </div>
                

                
  <div class="ct_mpda_wrp" id="js_sponsor_ad_area" style="display: none;"></div>


                
                <div class="read-more__area" id="js_more_read_area" style="display:none;">
                    
                </div>

                
                                <div class="reward_area tc reward_area_primary" id="js_preview_reward_author" style="display:none;">
                    <div class="reward-avatar" style="display: none;" id="js_preview_reward_author_avatar">
                        <img src="" alt="" id="js_preview_reward_author_head">
                    </div>
                    
                                        <div class="reward-author" id="js_preview_reward_author_name">张凯捷</div>
                                        <p class="reward_tips" id="js_preview_reward_author_wording" style="display:none;"></p>
                    <p class="reward_button_wrp">
                    
                      <span class="reward_pop_panel">
                        <img src="https://res.wx.qq.com/mpres/zh_CN/htmledition/pages/home/index/pic_mp_app4290ba.png" alt="">
                        <strong>扫一扫下载订阅号助手，用手机发文章</strong>
                      </span>
                        <a class="reward_button" id='js_preview_reward_author_link' href="##"><span id="js_preview_reward_link_text">赞赏</span></a>
                    </p>
                </div>

                <div class="reward_qrcode_area reward_area tc" id="js_preview_reward_qrcode" style="display:none;">
                    <p class="tips_global">长按二维码向我转账</p>
                    <p id="js_preview_reward_ios_wording" class="reward_tips" style="display:none;"></p>
                    <span class="reward_qrcode_img_wrp"><img class="reward_qrcode_img" src="res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_reward_qrcode.2x42f400.png"></span>
                    <p class="tips_global">受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。</p>
                </div>
                            </div>
		<div class="comment">
			<h3 style="margin:26px 0;font-weight:100;padding-bottom:4px;border-bottom:1px solid #ccc;">精选留言</h3>
		    暂无...
		</div>
	</div>
	<div class='dy_all'>
		<a href='https://www.52pojie.cn/' target='_blank'>
			吾爱破解论坛
		</a>
	</div>
</body>